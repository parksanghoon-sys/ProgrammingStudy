# CPU

CPU 란 RAM 메모리 또는 키보드와 같은 외부장치에서 입력을 받고, 전기회로에 의해 구현된 일련의  "CPU 명령어"를 통해 입력을 처리하고, 메모리에 출력을 쓰거나 외부장치에 명령을 보낸다.

중앙처리장치(CPU) 는 컴퓨터 프로그램의 명령을 실행하는 컴퓨터의 기본 프로세서이다. 프로세서는 외부데이터 소스(일반적으로 메모리 또는 기트 데이터 스트림)에 대한 작업을 수행하는전기 구성회로(직접회로)입니다.

CPU 회로에 하드 와이어링된 것은 명령어 세트라고 하는 수행할 수 있는 기본작업 세트이다. 각 명령어 기게어 opcode 라는 고유한 비트 조합으로 표시된다.

CPU는 웨이퍼 또는 실리콘 웨이퍼로 제조되며, 트렌지스터 및 배선 패턴의 회로는 제조과정에서 표면에 직접 제작이 된다, 패키지 완료 후 마더보드의 CPU 소켓에 설치가 가능하다, 중앙처리장치의 트렌지스터는 매우작으며 수많은 트렌지스터로 구성이된다.

## CPU Core

중앙처리장치는 하나이상의 코어를 포함하며, 각 코어는 CPU 내의 개별 처리장치이다, 여기는 처리단위에 처리단위가 포함되어 있다고 말하기 모호함이 있다. 이에 대해 생각할 수 있는 방법은 CPU는 일반적으로 마더보드 소켓에 연결되는 패키지를 나타내고 코어는 그안에 프로세서 단위를 의미한다, 코어가 2개 이상일 때 그것을 멀티코어라고 부르며, 일부 숫자N에 대해 듀얼코어, 쿼드코어 등 N코어CPU 와 같은 용어로 이어진다, 멀티코어는 병렬처리르 허용하며 성능이 크게 향상된다, CPU 코어는 주고 실행단위, 제어 장치 및 메모리로 구성된다.

### 실행단위

명령의 논리를 수행하는 **논리게이트** 로 구성된 회로이다, 정수 연산의 기본 실행단위는 ALU(Arithmetic-logic Unit)라고 한다, 부동 소수점 산술을 위해 FPU(Floating Point Unit)을 사용하는것이 일반적이다.

### 제어장치

제어장치는 데이터를 관리하고 하드웨어에 신호를 보내고, 명령을 처리한다. 여기에는 명령어를 디코딩하고, CPU 파이프라인을 오케스트레이션한고, 순서가 잘못된 명령어 실행을 처리하고, 분기예측을 수행하는 로직이 포함되어진다.

### 메모리

메모리에는 CPU 명령에대한 직접 입력 레지스터가 포함된다, 레지스터는 메모리 계층 구조 피라미드 맨 위에 있다. 코어에 대한 레지스터 집합을 레지스터 파일이라한다, 다양한 실행 단위에는 자체 레지스터 파일이 있을 수 있다. 예를들면 ALU 레지스터를 "정수 레지스터"라고 하며 FPU는 일반적으로 "부동소수점 레지스터"집합이 있다.

각 코에에는 L1 캐시가 있으며 L2 캐시, L3 캐시 또한 있을 수있다. 모든 로드 및 저장 명령을 실행하고, 로드 및 저장 작업의 가상 주소를 생성, 메모리에서 데이터를 로드하거나 레지스터에서 메모리로 다시 저장하는 특수 실행 단위이다.

## 명령 실행

CPU 코어의 주요 기능은 프로그램의 명령을 실행하느 것이다,  폰 노이만 아키택처의 특징은 명령어가 순차적으로 시행되고 한 명령어의 실행이 여러 단계로 분할될 수 있는것이다, 이를 작동하는 메모리에서 명령어와 데이터를 가져오는것이 동일한 메모리 버스를 사용하기 떄무에 다른 단계에서 수행되어야하기 떄문에 필요하다.

RISC의 5단계 파이프라인

1. 명령어 가져오기
2. 명령어 디코딩 및 레지스터 패치
3. Excute 실행
4. 메모리 엑세스
5. 레지스터 다시쓰기

이러한 각 단계는 프로세서으 ㅣ기본 logic blocks인 gates의 자체 control logic에 의해 구동된다, 게이트는 "CPU 명령 실행 주기 시계"에 의해 구동된다, 이것은 단일 명령어를 가져오고, 디코딩하며, 실행하는 과정에서 한 단계의 완룔를 알리는 CPU 내부 clock의 단일 펄스를 나타낸다 기본적으로 각 clock cycle은 전체 명령 실행 주기내의 한 단계를 나타내며 clock 속도는 cpu 가 명령을 처리할 수 이쓴ㄴ 속도에 직접적인 영향을 미친다, 클럭 속도는 Hz로 표시되며 일반적으로 오늘날의 컴퓨터의 경우 1GHz에서 3GHz사이 이다.

### 지시 파이프라이닝

명령 파이프라이닝은 단일 CPU 코에 내에서 명령 수준 병렬 처리를 구현하기 위한 기술이다, 파이프라이닝은 들어오는 명령을 서로다른 프로세서 유닛이 수행하는 일련의 순차적 단계로 나누어 명령의 다른 부분이 병렬로 처리되도록 하여 프로세서의 모든 부분을 일부 명령으로 바쁘게 유지한다, 모든 것이 완벽하게 진행되고 모든 단계가 바쁘게 유지되면 clock cycle마다 하나의 명령어가 완료됩니다.  **IPC(** [**Instructions Per Cycle)**](https://www.cgdirector.com/what-is-cpu-ipc/)는 1.0입니다. CPU가 초당 얼마나 많은 명령을 실행하는지 알고 싶다면 IPC에 클럭 속도를 곱하면 됩니다. 예를 들어, IPC가 1.0이고 일부 CPU의 경우 클럭 주파수가 2GHz인 경우 초당 20억 개의 명령을 실행할 수 있습니다.

파이프라인 단계를 완료하는 데 더 많은 시간이 필요한 경우도 있습니다. 이에 대한 포스터 자식은 메모리 작업을 수행하는 명령어가 캐시 누락을 겪는 경우도 존재한다. 이렇게 되면 메모리 작업이 완료될 떄까지 파이프라인이 차단되는 파이프라인 중단이 발생한다.

## CPU 최적화

### 브랜치 에측

프로그램이 코드에서 분기되는 방식을 예측, 성능향상을 시켜 오버헤드줄인다

### 비순차적 실행

CPU가 원래 코드 스퀀스보다 더 효율적인 순서로 명령을 싱행

### 하이퍼 스레딩

논리적 코어당 여러 논리코어를 생성, 여러스레드를 동시에 실행

### 캐시계층

다양한 수준의 캐시메모리 L1,L2,L3를 사용, 자주엑세스하는 데이터를 저장하고 더 빠르게 검색

### 특수지침

ISA 는 복잡한 도메인별 작업을 수행하기위한 명령으로 보강된다.

* FPU의 부동소수점 멸영어는 부동 소수점 산술을 수행
* 백터 명령어 또는 SIMD 명령어는 백터 또는 행렬의 연선을 효율적으로 수행
* 인텔 AES 명령어 및 RICS-V 암호화 명령어는 암호화 및 복호화 기능을 수행한다

### 슈퍼 스칼라

[**수퍼 스칼라 코어**](https://www.geeksforgeeks.org/superscalar-architecture/) 또는 **수퍼 스칼라 프로세서**에서는 일부 스테이지 단위가 복제되어 [명령 수준 병렬 처리를](https://en.wikipedia.org/wiki/Instruction-level_parallelism) 증가, lock cycle당 최대 하나의 단일 명령어를 실행할 수 있는 [scalar 프로세서](https://en.wikipedia.org/wiki/Scalar_processor)와 달리, superscalar 프로세서는 프로세서의 다른 [실행 장치에](https://en.wikipedia.org/wiki/Execution_unit) 여러 명령어를 동시에 디스패치하여 clock cycle 동안 둘 이상의 명령어를 실행하거나 실행할 수 있습니다. 수퍼 스칼라 아키텍처에서는 성능 향상을 위해 IPC가 1.0보다 클 수 있습니다.
