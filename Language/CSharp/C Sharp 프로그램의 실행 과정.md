C# 프로그램이 작성되고 실행되기까지의 과정을 쉽게 이해할 수 있도록 설명해 드리겠습니다. 마치 편지를 쓰고 배달하는 과정으로 생각해볼 수 있어요.

## 1. 소스 코드 작성하기 (편지 쓰기)

먼저 프로그래머가 C# 언어로 소스 코드를 작성합니다. 이것은 `.cs` 확장자를 가진 파일들입니다. 이는 마치 여러분이 사람이 읽을 수 있는 언어로 편지를 쓰는 것과 같습니다.

csharp

```csharp
// Hello.cs 파일
using System;

class Program
{
    static void Main()
    {
        Console.WriteLine("안녕하세요!");
    }
}
```

## 2. 컴파일 과정 (편지를 번역하기)

작성한 C# 코드는 컴퓨터가 직접 이해할 수 없습니다. 컴파일러(csc.exe)가 이 코드를 컴퓨터가 이해할 수 있는 중간 언어(IL: Intermediate Language)로 변환합니다. 이 과정은 마치 여러분의 편지를 우체국 직원이 배달 시스템이 이해할 수 있는 특별한 형식으로 번역하는 것과 같습니다.

컴파일 결과로 `.exe` 또는 `.dll` 파일이 생성됩니다. 이 파일들은 IL 코드와 메타데이터를 포함하고 있습니다.

## 3. 어셈블리 생성 (편지 봉투에 넣기)

컴파일된 코드는 어셈블리라는 단위로 패키징됩니다. 어셈블리는 실행 가능한 코드 단위로, 메타데이터(코드에 대한 정보)를 포함합니다. 이는 편지를 봉투에 넣고 주소와 정보를 적는 것과 비슷합니다.

## 4. CLR 로딩 (우체부가 배달 준비하기)

프로그램을 실행하면, 운영체제는 .NET의 Common Language Runtime(CLR)을 로드합니다. CLR은 .NET 프로그램을 실행하는 가상 머신입니다. 이것은 마치 우체부가 여러분의 편지를 받아 배달 준비를 하는 것과 같습니다.

## 5. JIT 컴파일 (현지 언어로 다시 번역하기)

CLR의 JIT(Just-In-Time) 컴파일러는 IL 코드를 실행 중인 컴퓨터의 CPU가 이해할 수 있는 네이티브 기계어 코드로 변환합니다. 이 변환은 코드가 실행될 때 일어납니다(즉, "Just-In-Time"). 이는 마치 우체부가 편지를 받는 사람의 지역 언어로 다시 번역하는 것과 같습니다.

## 6. 프로그램 실행 (편지 전달하기)

JIT 컴파일된 코드는 CPU에서 실행됩니다. 이제 프로그램이 동작하기 시작하며, 화면에 "안녕하세요!"가 출력됩니다. 이는 편지가 최종적으로 수신자에게 전달되어 읽히는 것과 같습니다.

## 7. 가비지 컬렉션 (정리하기)

프로그램이 실행되는 동안, CLR의 가비지 컬렉터는 더 이상 사용되지 않는 메모리를 자동으로 해제합니다. 이는 편지가 읽힌 후 불필요한 포장지를 정리하는 것과 같습니다.

## 요약

1. C# 코드 작성 (사람이 읽을 수 있는 편지)
2. 컴파일러가 IL 코드로 변환 (배달 시스템용 형식으로 번역)
3. 어셈블리 생성 (봉투에 넣기)
4. CLR 로딩 (우체부 준비)
5. JIT 컴파일 (현지 언어로 번역)
6. 코드 실행 (편지 읽기)
7. 가비지 컬렉션 (정리)
# C# 코드 실행 방식 상세 설명

C# 프로그램은 **미리 컴파일된 상태**로 실행됩니다. 그러나 일부 코드는 실행 시점에 필요할 때 JIT 컴파일됩니다. 구체적으로 설명하자면:

## 컴파일 단계 (프로그램 실행 전)

1. 여러분이 C# 코드를 작성하고 빌드(Build)하면, 모든 코드는 **미리 IL(Intermediate Language)로 컴파일**됩니다.
2. 이 컴파일된 코드는 `.exe` 또는 `.dll` 파일 안에 저장됩니다. 이 파일에는 프로그램의 **모든** IL 코드가 포함되어 있습니다.
3. 이 시점에서 코드는 아직 CPU가 직접 실행할 수 있는 형태(기계어)는 아니지만, 중간 형태로 변환된 상태입니다.

## 실행 단계 (프로그램 실행 시)

1. 프로그램을 실행하면, `.exe` 파일(또는 `.dll`을 사용하는 프로그램)이 메모리에 로드됩니다.
2. 그러나 **모든 코드가 한 번에 기계어로 변환되지는 않습니다**. 대신, CLR은 필요할 때마다 메서드 단위로 JIT 컴파일을 수행합니다:
    - 처음 특정 메서드가 호출될 때 JIT 컴파일러가 해당 메서드의 IL 코드를 기계어로 변환합니다.
    - 변환된 기계어 코드는 메모리에 저장되어 이후 같은 메서드가 호출될 때 재사용됩니다.
    - 한 번 JIT 컴파일된 메서드는 프로그램이 실행되는 동안 다시 컴파일할 필요가 없습니다.
3. 이것은 "주소만 있는" 것이 아니라, 실제로 필요한 코드가 메모리에 위치하고 있으며 필요할 때 CPU가 실행할 수 있는 형태로 변환됩니다.

## 예시로 이해하기

이렇게 생각해보세요:

- **빌드 시**: 여러분의 모든 C# 코드가 "반제품" 형태(IL)로 변환되어 `.exe` 또는 `.dll` 파일에 저장됩니다.
- **실행 시**: 프로그램이 시작되면, 필요한 부분만 "완제품"(기계어)으로 최종 변환됩니다.
    - Main() 메서드가 먼저 실행되므로 먼저 변환됩니다.
    - 그 다음, Main()에서 호출하는 다른 메서드들이 호출될 때 변환됩니다.
    - 프로그램의 어떤 부분이 한 번도 실행되지 않으면, 해당 부분은 JIT 컴파일되지 않습니다.

이 방식은 프로그램 시작 시간을 최적화하고, 실제로 사용되는 코드만 컴파일하여 메모리와 CPU 자원을 효율적으로 사용할 수 있게 합니다.

## 요약

- 코드는 실행 전에 모두 IL로 컴파일되어 있습니다.
- 실행 중에는 필요한 메서드만 그때그때 JIT 컴파일되어 기계어로 변환됩니다.
- 이미 변환된 메서드는 메모리에 저장되어 재사용됩니다.

따라서 "그때그때 가져오는 것"과 "다 컴파일된 상태"의 중간 형태라고 볼 수 있습니다.