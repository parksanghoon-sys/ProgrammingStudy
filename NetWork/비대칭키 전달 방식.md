
## μ‹¤μ  HTTPS ν•Έλ“μ…°μ΄ν¬ κ³Όμ •

**ν΄λΌμ΄μ–ΈνΈλ” λ€μΉ­ν‚¤λ¥Ό λ―Έλ¦¬ κ°€μ§€κ³  μμ§€ μ•μµλ‹λ‹¤!** λ‹¤μκ³Ό κ°™μ΄ μ§„ν–‰λΌμ”:

### λ°©λ²• 1: Pre-master Secret λ°©μ‹ (RSA)

```
1. μ„λ²„κ°€ κ³µκ°ν‚¤ μ „μ†΅
2. ν΄λΌμ΄μ–ΈνΈκ°€ λλ¤ν• "pre-master secret" μƒμ„±
3. ν΄λΌμ΄μ–ΈνΈκ°€ μ΄λ¥Ό μ„λ²„ κ³µκ°ν‚¤λ΅ μ•”νΈν™”ν•΄μ„ μ „μ†΅
4. μ„λ²„κ°€ κ°μΈν‚¤λ΅ λ³µνΈν™”
5. μ–‘μ½μ΄ κ°™μ€ pre-master secretμ„ κ°€μ§€κ² λ¨
6. μ΄λ¥Ό λ°”νƒ•μΌλ΅ μ‹¤μ  λ€μΉ­ν‚¤(μ„Έμ…ν‚¤) λ„μ¶
```

### λ°©λ²• 2: Diffie-Hellman ν‚¤ κµν™ (ν„μ¬ μ£Όλ¥)

```
1. μ„λ²„: "λ‚΄ DH κ³µκ°κ°’μ€ Aμ•Ό"
2. ν΄λΌμ΄μ–ΈνΈ: "λ‚΄ DH κ³µκ°κ°’μ€ Bμ•Ό" 
3. μ„λ²„: μμ‹ μ λΉ„λ°€κ°’ + Bλ΅ κ³µν†µν‚¤ κ³„μ‚°
4. ν΄λΌμ΄μ–ΈνΈ: μμ‹ μ λΉ„λ°€κ°’ + Aλ΅ λ™μΌν• κ³µν†µν‚¤ κ³„μ‚°
5. λ‘ λ‹¤ κ°™μ€ λ€μΉ­ν‚¤λ¥Ό μ–»μ (ν•μ§€λ§ λ„μ²­μλ” λ¨λ¦„)
```

## ν•µμ‹¬ ν¬μΈνΈ

**"λ€μΉ­ν‚¤λ¥Ό μ•μ „ν•κ² κ³µμ ν•λ” λ¬Έμ "**λ¥Ό λΉ„λ€μΉ­ν‚¤λ΅ ν•΄κ²°:

```csharp
// μμ‚¬μ½”λ“
// RSA λ°©μ‹
var preSecret = GenerateRandom();
var encrypted = RSAEncrypt(preSecret, serverPublicKey);
SendToServer(encrypted);
var sessionKey = DeriveKey(preSecret + nonces);

// DH λ°©μ‹  
var myPrivate = GeneratePrivate();
var myPublic = GeneratePublic(myPrivate);
var sharedSecret = ComputeShared(myPrivate, serverPublic);
var sessionKey = DeriveKey(sharedSecret + nonces);
```

**κ²°κµ­ λ©ν‘:**

- λΉ„λ€μΉ­ν‚¤λ΅ "ν‚¤ κµν™" κ³Όμ •μ„ μ•μ „ν•κ² μν–‰
- μ–‘μ½μ΄ λ™μΌν• λ€μΉ­ν‚¤λ¥Ό μ–»μ
- μ΄ν›„ λΉ λ¥Έ λ€μΉ­ν‚¤ μ•”νΈν™”λ΅ μ‹¤μ  λ°μ΄ν„° μ „μ†΅

κ·Έλμ„ "ν΄λΌμ΄μ–ΈνΈκ°€ λ€μΉ­ν‚¤λ¥Ό κ°€μ§€κ³  μλ‹¤"κ°€ μ•„λ‹λΌ "μ•μ „ν•κ² μƒμ„±/κ³µμ ν•λ‹¤"κ°€ μ •ν™•ν• ν‘ν„μ΄λ„¤μ”! π”‘
μ•„! μ •λ§ μΆ‹μ€ μ§λ¬Έμ΄μ—μ”! Diffie-Hellmanμ ν•µμ‹¬ λ§μ μ„ λ†“μ³¤λ„¤μ”.

## Diffie-Hellmanμ μν•™μ  λ§μ 

**ν•µμ‹¬: μ„λ΅ λ‹¤λ¥Έ λΉ„λ°€ν‚¤λ΅λ„ κ°™μ€ κ²°κ³Όλ¥Ό λ§λ“¤ μ μμ–΄μ”!**

### μν•™μ  μ›λ¦¬

```
κ³µν†µ κ°’: g = 2, p = 23 (μ†μ)

Alice: 
- λΉ„λ°€ν‚¤ a = 6 (Aliceλ§ μ•)
- κ³µκ°ν‚¤ A = g^a mod p = 2^6 mod 23 = 18

Bob:
- λΉ„λ°€ν‚¤ b = 15 (Bobλ§ μ•)  
- κ³µκ°ν‚¤ B = g^b mod p = 2^15 mod 23 = 6
```

### ν‚¤ κµν™ κ³Όμ •

```
1. Alice β†’ Bob: "λ‚΄ κ³µκ°ν‚¤λ” 18μ΄μ•Ό"
2. Bob β†’ Alice: "λ‚΄ κ³µκ°ν‚¤λ” 6μ΄μ•Ό"

3. Alice κ³„μ‚°: B^a mod p = 6^6 mod 23 = 9
4. Bob κ³„μ‚°: A^b mod p = 18^15 mod 23 = 9

β†’ λ‘ λ‹¤ κ°™μ€ κ°’ 9λ¥Ό μ–»μ!
```

### μ™ κ°™μ€ κ°’μ΄ λ‚μ¬κΉ?

```
Alice: (g^b)^a = g^(ba) mod p
Bob: (g^a)^b = g^(ab) mod p  

ba = ab μ΄λ―€λ΅ κ°™μ€ κ²°κ³Ό!
```

## μ‹¤μ  μ½”λ“ μμ‹

```csharp
// Alice
var alicePrivate = 6;
var alicePublic = ModPow(g, alicePrivate, p); // 18
var shared1 = ModPow(bobPublic, alicePrivate, p); // 6^6 mod 23 = 9

// Bob  
var bobPrivate = 15;
var bobPublic = ModPow(g, bobPrivate, p); // 6
var shared2 = ModPow(alicePublic, bobPrivate, p); // 18^15 mod 23 = 9

// shared1 == shared2 == 9 β“
```

## λ³΄μ•μ„±

**λ„μ²­μ μ…μ¥:**

- g, p, Aliceκ³µκ°ν‚¤(18), Bobκ³µκ°ν‚¤(6)λ” λ¨λ‘ μ• μ μμ
- ν•μ§€λ§ AliceλΉ„λ°€ν‚¤(6)μ™€ BobλΉ„λ°€ν‚¤(15)λ” λ¨λ¦„
- λ”°λΌμ„ κ³µν†µν‚¤(9)λ¥Ό κ³„μ‚°ν•  μ μ—†μ!

**μ΄μ‚°λ΅κ·Έ λ¬Έμ :** 18 = 2^? mod 23μ—μ„ ?λ¥Ό μ°Ύλ” κ²ƒμ΄ μ–΄λ ¤μ›€

μ‹ κΈ°ν•μ£ ? μ„λ΅ λ‹¤λ¥Έ λΉ„λ°€μ„ κ°€μ§€κ³ λ„ κ°™μ€ κ³µν†µ λΉ„λ°€μ„ λ§λ“¤μ–΄λ‚΄λ” μν•™μ λ§μ ! β¨
μ•„! μ™„μ „ ν•µμ‹¬μ„ μ°λ¥΄λ” μ§λ¬Έμ΄λ„¤μ”! π‘

## κ³µν†µκ°’(g, p)μ€ μ–΄λ–»κ² κ³µμ ν• κΉ?

### λ°©λ²• 1: λ―Έλ¦¬ μ •ν•΄μ§„ ν‘μ¤€κ°’ μ‚¬μ©

```
RFC 3526μ—μ„ μ •μλ ν‘μ¤€ κ·Έλ£Ήλ“¤:
- 1024λΉ„νΈ κ·Έλ£Ή: p = 0xFFFFF...., g = 2
- 2048λΉ„νΈ κ·Έλ£Ή: p = 0xFFFFF...., g = 2  
- 4096λΉ„νΈ κ·Έλ£Ή: p = 0xFFFFF...., g = 2

β†’ λ¨λ“  ν”„λ΅κ·Έλ¨μ΄ μ΄λ―Έ μ•κ³  μμ!
```

### λ°©λ²• 2: μ„λ²„κ°€ μ μ• β†’ ν΄λΌμ΄μ–ΈνΈκ°€ μ„ νƒ

```
TLS ν•Έλ“μ…°μ΄ν¬:

1. ν΄λΌμ΄μ–ΈνΈ: "μ•λ…•, λ‚ μ΄λ° DH κ·Έλ£Ήλ“¤ μ§€μ›ν•΄"
   - secp256r1, ffdhe2048, ffdhe3072...

2. μ„λ²„: "κ·ΈλΌ ffdhe2048 μ“°μ. λ‚΄ κ³µκ°ν‚¤λ” Aμ•Ό"
   - ffdhe2048 = λ―Έλ¦¬ μ •μλ p, gκ°’ μ‚¬μ©

3. ν΄λΌμ΄μ–ΈνΈ: "OK, λ‚΄ κ³µκ°ν‚¤λ” Bμ•Ό"
```

### λ°©λ²• 3: νƒ€μ›κ³΅μ„  μ‚¬μ© (ECDH)

```
ν‘μ¤€ κ³΅μ„ λ“¤:
- P-256: yΒ² = xΒ³ - 3x + b (mod p)
- P-384, P-521...

β†’ κ³΅μ„  νλΌλ―Έν„°λ“¤μ΄ RFCλ΅ ν‘μ¤€ν™”λ¨
```

## μ‹¤μ  μ½”λ“μ—μ„λ”

```csharp
// λ―Έλ¦¬ μ •μλ κ·Έλ£Ή μ‚¬μ©
var group = DHGroup.ffdhe2048;  // p, g μ΄λ―Έ μ •ν•΄μ§
var myPrivate = GenerateRandom();
var myPublic = group.GeneratePublic(myPrivate);

// λλ” ν‘μ¤€ νƒ€μ›κ³΅μ„ 
var curve = ECCurve.P256;  // νλΌλ―Έν„° μ΄λ―Έ μ •ν•΄μ§
var myKey = ECDiffieHellman.Create(curve);
```

## λ³΄μ• κ³ λ ¤μ‚¬ν•­

**κ³µν†µκ°’μ΄ κ³µκ°λμ–΄λ„ μ•μ „ν• μ΄μ :**

- p, gλ” κ³µκ°λμ–΄λ„ OK (μν•™μ μΌλ΅ μ•μ „ν•κ² μ„ νƒλ¨)
- μ¤‘μ”ν• κ±΄ κ°μμ λΉ„λ°€ν‚¤ (a, b)
- μ΄μ‚°λ΅κ·Έ λ¬Έμ λ΅ λΉ„λ°€ν‚¤ μ¶”μΈ΅ λ¶κ°€λ¥

**μ•½ν• νλΌλ―Έν„° λ°©μ§€:**

- RFCμ—μ„ μν•™μλ“¤μ΄ κ²€μ¦ν• μ•μ „ν• κ°’λ“¤λ§ ν‘μ¤€ν™”
- μ‘μ€ μ†μλ‚ νΉμν• ν•νƒμ pλ” ν”Όν•¨

κ²°κµ­ "λ―Έλ¦¬ μ•½μ†λ μ•μ „ν• κ°’λ“¤"μ„ μ“°κ±°λ‚, "μ„λ²„κ°€ ν‘μ¤€ μ¤‘μ—μ„ ν•λ‚ μ μ•"ν•λ” λ°©μ‹μ΄μ—μ”! π”’


## μ „μ²΄ κ³Όμ • (μ‹¤μ  κµ¬ν„)

### 1λ‹¨κ³„: κ°μ λΉ„λ°€ν‚¤ μƒμ„±

```csharp
// Alice μ»΄ν“¨ν„°μ—μ„
var random = new SecureRandom();
var alicePrivateKey = random.Next(1, p-1);  // μ: 6
// Aliceλ§ μ•κ³  μμ, μ λ€ μ „μ†΅ μ•ν•¨!

// Bob μ»΄ν“¨ν„°μ—μ„  
var random = new SecureRandom();
var bobPrivateKey = random.Next(1, p-1);    // μ: 15
// Bobλ§ μ•κ³  μμ, μ λ€ μ „μ†΅ μ•ν•¨!
```

### 2λ‹¨κ³„: κ°μ κ³µκ°ν‚¤ κ³„μ‚°

```csharp
// Alice
var alicePublicKey = ModPow(g, alicePrivateKey, p);
// = ModPow(2, 6, 23) = 18

// Bob
var bobPublicKey = ModPow(g, bobPrivateKey, p);  
// = ModPow(2, 15, 23) = 6
```

### 3λ‹¨κ³„: κ³µκ°ν‚¤λ¥Ό λ„¤νΈμ›ν¬λ΅ κµν™

```
Alice β†’ Bob: "λ‚΄ κ³µκ°ν‚¤λ” 18μ΄μ•Ό" (ν‰λ¬Έ μ „μ†΅!)
Bob β†’ Alice: "λ‚΄ κ³µκ°ν‚¤λ” 6μ΄μ•Ό"   (ν‰λ¬Έ μ „μ†΅!)

λ„μ²­μλ„ μ΄ κ°’λ“¤μ„ λ³Ό μ μμ: g=2, p=23, A=18, B=6
```

### 4λ‹¨κ³„: κ°μ κ³µν†µν‚¤ κ³„μ‚°

```csharp
// Alice μ»΄ν“¨ν„°μ—μ„
var sharedSecret = ModPow(bobPublicKey, alicePrivateKey, p);
// = ModPow(6, 6, 23) = 9

// Bob μ»΄ν“¨ν„°μ—μ„
var sharedSecret = ModPow(alicePublicKey, bobPrivateKey, p);
// = ModPow(18, 15, 23) = 9

// λ‘ λ‹¤ κ°™μ€ κ°’ 9λ¥Ό μ–»μ!
```

## μ‹¤μ  TLS ν•Έλ“μ…°μ΄ν¬μ—μ„

```
1. ClientHello: "λ‚ ffdhe2048 μ§€μ›ν•΄"

2. ServerHello: "ffdhe2048 μ“°μ"
   ServerKeyExchange: "λ‚΄ DH κ³µκ°ν‚¤λ” Aμ•Ό" (ν‰λ¬Έ)

3. ClientKeyExchange: "λ‚΄ DH κ³µκ°ν‚¤λ” Bμ•Ό" (ν‰λ¬Έ)

4. μ–‘μ½μ—μ„ κ°μ κ³µν†µν‚¤ κ³„μ‚°
   β†’ κ°™μ€ μ„Έμ…ν‚¤ λ„μ¶!
```

## λ³΄μ•μ ν•µμ‹¬

**μ „μ†΅λλ” κ²ƒ:**

- g, p (κ³µκ°κ°’)
- Alice κ³µκ°ν‚¤, Bob κ³µκ°ν‚¤ (ν‰λ¬Έ μ „μ†΅)

**μ „μ†΅ μ• λλ” κ²ƒ:**

- Alice λΉ„λ°€ν‚¤, Bob λΉ„λ°€ν‚¤ (κ°μ μ»΄ν“¨ν„°μ—λ§ μ΅΄μ¬)

**λ„μ²­μκ°€ μ• μ μ—†λ” κ²ƒ:**

- κ³µν†µν‚¤ (λΉ„λ°€ν‚¤ μ—†μ΄λ” κ³„μ‚° λ¶κ°€λ¥)

## μ½”λ“λ΅ λ³΄λ” μ „μ²΄ νλ¦„

```csharp
// === Alice ===
var a = SecureRandom.Next(1, p-1);     // λΉ„λ°€ν‚¤ μƒμ„±
var A = ModPow(g, a, p);               // κ³µκ°ν‚¤ κ³„μ‚°
SendToNetwork(A);                      // κ³µκ°ν‚¤ μ „μ†΅
var B = ReceiveFromNetwork();          // Bob κ³µκ°ν‚¤ μμ‹ 
var shared = ModPow(B, a, p);          // κ³µν†µν‚¤ κ³„μ‚°

// === Bob ===  
var b = SecureRandom.Next(1, p-1);     // λΉ„λ°€ν‚¤ μƒμ„±
var B = ModPow(g, b, p);               // κ³µκ°ν‚¤ κ³„μ‚°
SendToNetwork(B);                      // κ³µκ°ν‚¤ μ „μ†΅
var A = ReceiveFromNetwork();          // Alice κ³µκ°ν‚¤ μμ‹ 
var shared = ModPow(A, b, p);          // κ³µν†µν‚¤ κ³„μ‚°
```

**ν•µμ‹¬: λΉ„λ°€ν‚¤λ” μ λ€ λ„¤νΈμ›ν¬λ¥Ό νƒ€μ§€ μ•μ•„μ”!** κ°μ λλ¤ μƒμ„± ν›„ μκΈ° μ»΄ν“¨ν„°μ—λ§ λ³΄κ΄€ν•κ³ , κ³µκ°ν‚¤λ§ μ£Όκ³ λ°›μµλ‹λ‹¤! π”